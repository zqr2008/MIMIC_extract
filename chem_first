chem_final AS
(SELECT
ie.stay_id,
le.*,
ROW_NUMBER () OVER (PARTITION BY ie.stay_id ORDER BY le.charttime) as le_seq
FROM `physionet-data.mimic_icu.icustays` ie
LEFT JOIN `physionet-data.mimic_derived.chemistry` le
ON le.subject_id = ie.subject_id
),

chem_first AS
(
SELECT
ie.subject_id,
ie.stay_id,
albumin,
globulin,
total_protein,
aniongap,
bicarbonate,
bun,
calcium,
chloride,
creatinine,
glucose,
sodium,
potassium
FROM `physionet-data.mimic_icu.icustays` ie
LEFT JOIN chem_final cf
ON ie.stay_id = cf.stay_id
AND cf.le_seq = 1
),
