enz_final AS
(SELECT
ie.stay_id,
le.*,
ROW_NUMBER () OVER (PARTITION BY ie.stay_id ORDER BY le.charttime) as le_seq
FROM `physionet-data.mimic_icu.icustays` ie
LEFT JOIN `physionet-data.mimic_derived.enzyme` le
ON le.subject_id = ie.subject_id
),

enz_first AS
(SELECT
ie.subject_id,
ie.stay_id,
alt,
alp,
ast,
amylase,
bilirubin_total,
bilirubin_direct,
bilirubin_indirect,
ck_cpk,
ck_mb,
ggt,
ld_ldh
FROM `physionet-data.mimic_icu.icustays` ie
LEFT JOIN enz_final ef
ON ie.stay_id = ef.stay_id
AND ef.le_seq = 1
),
